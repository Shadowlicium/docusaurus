"use strict";(self.webpackChunkprojet_docu=self.webpackChunkprojet_docu||[]).push([[716],{2652:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/smb-951a704d6a905867579d2f3bffdbd998.png"},7478:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"ADDS/samba-adds","title":"samba-adds","description":"Samba sera installer sur un debian 12 en cloud sur AWS avec les composants suivant :","source":"@site/docs/ADDS/samba-adds.md","sourceDirName":"ADDS","slug":"/ADDS/samba-adds","permalink":"/docs/ADDS/samba-adds","draft":false,"unlisted":false,"editUrl":"https://github.com/Shadowlicium/docusaurus/docs/ADDS/samba-adds.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"planification de gestion de projet","permalink":"/docs/ADDS/planification de gestion de projet"},"next":{"title":"NFS","permalink":"/docs/ADDS/NFS"}}');var r=s(4848),a=s(8453);const d={sidebar_position:5},t=void 0,l={},c=[{value:"Configuration :",id:"configuration-",level:3},{value:"Rejoindre le domaine",id:"rejoindre-le-domaine",level:3},{value:"Cr\xe9er un utilisateur dans l&#39;adds de Samba",id:"cr\xe9er-un-utilisateur-dans-ladds-de-samba",level:3},{value:"Se connecter a un utilisateur de l&#39;adds",id:"se-connecter-a-un-utilisateur-de-ladds",level:3},{value:"Annexe",id:"annexe",level:3}];function o(e){const n={br:"br",code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Samba sera installer sur un debian 12 en cloud sur AWS avec les composants suivant :"}),"\n",(0,r.jsxs)(n.p,{children:["CPU : 1",(0,r.jsx)(n.br,{}),"\n","RAM : 1 Go",(0,r.jsx)(n.br,{}),"\n","disk : 20 Go",(0,r.jsx)(n.br,{}),"\n","Version SAMBA : 4.17.12-Debian"]}),"\n",(0,r.jsx)(n.p,{children:"Il a tout d'abord \xe9t\xe9 tester en interne dans une vm avant de le transferer sur AWS afin de s'assurer de la fonctionnalit\xe9 de celui-ci."}),"\n",(0,r.jsx)(n.p,{children:"Les test r\xe9aliser en interne a \xe9t\xe9 :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"La cr\xe9ation de l'active directory"}),"\n",(0,r.jsx)(n.li,{children:"La r\xe9alisation d'un dossier de partage nfs"}),"\n",(0,r.jsx)(n.li,{children:"La cr\xe9ation d'utilisateur ainsi que la prise de contr\xf4le d'un utilisateur de l'ad."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-",children:"Configuration :"}),"\n",(0,r.jsx)(n.p,{children:"Changer le nom de la machine si n\xe9cessaire"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"hostnamectl set-hostname nom_du_serveur\n"})}),"\n",(0,r.jsx)(n.p,{children:"Il faudra ensuite modifier la r\xe9solution de noms"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"nano /etc/hosts\n\n127.0.0.1\t\tlocalhost\n192.168.100.250\tnom_machine.domaine.racine\t\tnom_machine     domaine.racine\n"})}),"\n",(0,r.jsx)(n.p,{children:"contenu a valider"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"nano /etc/nsswitch.conf\nhosts: files dns\n"})}),"\n",(0,r.jsx)(n.p,{children:"Installation des applications et services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"apt update && apt upgrade -y\nexport DEBIAN_FRONTEND=noninteractive\napt install acl attr samba samba-dsdb-modules samba-vfs-modules winbind libpam-winbind -y\napt install libnss-winbind libpam-krb5 krb5-config krb5-user dnsutils smbclient ldb-tools -y\napt install ntp ntpdate -y\nunset DEBIAN_FRONTEND\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Si l'installation ne se fait pas, n'oublier pas de modifier le resolv.conf afin de naviguer sur internet !"})}),"\n",(0,r.jsxs)(n.p,{children:["Re-modifier le contenu du fichier",(0,r.jsx)(n.br,{}),"\n","/etc/resolv.conf"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"search domaine.racine\nnameserver 127.0.0.1\n"})}),"\n",(0,r.jsx)(n.p,{children:"Effacer le fichier de config samba (par d\xe9faut)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rm /etc/samba/smb.conf\n"})}),"\n",(0,r.jsx)(n.p,{children:"D\xe9ployer le domaine \u2018domaine.racine\u2019"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"samba-tool domain provision --realm=domaine.racine --domain=domaine --server-role=dc\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Copier le fichier krb5.conf dans le dossier ",(0,r.jsx)(n.strong,{children:"/etc"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cp /var/lib/samba/private/krb5.conf /etc/krb5.conf\n"})}),"\n",(0,r.jsx)(n.p,{children:"Une fois termin\xe9, v\xe9rifier que le fichier contient bien les directives suivantes :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[libdefaults]\ndefault_realm = domaine.racine\ndns_lookup_realm = false\ndns_lookup_kdc = true\n"})}),"\n",(0,r.jsx)(n.p,{children:"Mise en place du mot de passe de administrator (mdp fort exig\xe9)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"samba-tool user setpassword administrator\n"})}),"\n",(0,r.jsx)(n.p,{children:"Activer les services Samba au d\xe9marrage de la machine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"systemctl unmask samba-ad-dc\nsystemctl --now enable samba-ad-dc\nsystemctl disable nmbd smbd\nsystemctl mask nmbd smbd\n"})}),"\n",(0,r.jsxs)(n.p,{children:["redemarrer ensuite la machine puis on v\xe9rifie le fonctionnement des services ",(0,r.jsx)(n.strong,{children:"Kerberos"})," et ",(0,r.jsx)(n.strong,{children:"DNS"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kinit administrator\nklist\ndig @localhost nom_machine.domaine.racine\n"})}),"\n",(0,r.jsx)(n.h3,{id:"rejoindre-le-domaine",children:"Rejoindre le domaine"}),"\n",(0,r.jsx)(n.p,{children:"Pour rejoindre le domaine il suffira d'entrer sur une machine cliente"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"realm join nom.domaine.racine\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cr\xe9er-un-utilisateur-dans-ladds-de-samba",children:"Cr\xe9er un utilisateur dans l'adds de Samba"}),"\n",(0,r.jsx)(n.p,{children:"Pour cr\xe9er un utilsateur, il faudra tout d'abord en ajouter un sur la machine local"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"adduser nom_utilisateur\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cr\xe9er ensuite l'utilisateur sur Samba"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"smbpasswd -a nom_utilisateur\n"})}),"\n",(0,r.jsx)(n.p,{children:"Ajouter ensuite l'utilisateur au partage de fichier"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"smbpasswd -e nom_utilisateur\n"})}),"\n",(0,r.jsx)(n.p,{children:"Pour voir les utilisateurs ainsi que leur groupe"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pdbedit -L\n"})}),"\n",(0,r.jsx)(n.h3,{id:"se-connecter-a-un-utilisateur-de-ladds",children:"Se connecter a un utilisateur de l'adds"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ssh nom_utilisateur@domaine.racine\n"})}),"\n",(0,r.jsx)(n.h3,{id:"annexe",children:"Annexe"}),"\n",(0,r.jsx)(n.p,{children:"exemple d'une config smb pour samba"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(2652).A+"",width:"1428",height:"725"})}),"\n",(0,r.jsx)(n.p,{children:"exemple d'une configuration krb5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(9704).A+"",width:"1411",height:"483"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var i=s(6540);const r={},a=i.createContext(r);function d(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(a.Provider,{value:n},e.children)}},9704:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/krb5-7d1d83aa9c813697266216e73b71e7f2.png"}}]);